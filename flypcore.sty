% created and maintained by Noah D. Ortiz at analyticalnoa@gmail.com.
% component of the flyptex package.
% public repo availabe at github.com/analyticalnoa/flyptex.

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{flypcore}[2019/05/25]

% makeat commands
\newcommand{\AL}{\makeatletter}
\newcommand{\AO}{\makeatother}

% import the standard library.
\RequirePackage{amsmath, amssymb, amsthm, mathrsfs}
\RequirePackage{mathtools}
\RequirePackage{physics}
\RequirePackage{enumerate}
\RequirePackage{enumitem}
\RequirePackage[ampersand]{easylist}
\RequirePackage{booktabs}
\RequirePackage[load=accepted,load=prefixed,load=abbr]{siunitx}
\RequirePackage{graphicx}
\RequirePackage[section]{placeins}
%\RequirePackage[small,compact]{titlesec}
\RequirePackage[version=4]{mhchem}
\RequirePackage{microtype}
\RequirePackage{empheq}
\RequirePackage{setspace}
\RequirePackage{fancyhdr}
\RequirePackage{datetime2}

% datetime2
\DTMusemodule{english}{en-NZ}
\DTMsetstyle{en-NZ}

% needspace.
\usepackage{needspace}
\newlength{\neededspace}\setlength{\neededspace}{0.2\textheight}

% import legacy macros for compatibility.
\RequirePackage{flyplgcy}

% references.
\RequirePackage{varioref}
\RequirePackage{hyperref}
\hypersetup{
    linktocpage,
    colorlinks=true,
    linkcolor=blue,
    citecolor=blue
}
\RequirePackage[nameinlink]{cleveref}

% nested environment.
\RequirePackage{scrextend}
\newlength{\nesting}
\setlength{\nesting}{\parindent}
\newcommand{\makenested}[1]{%%
  \newenvironment{nested#1}[1][]{
    \needspace{\neededspace}%%
    \begin{#1}[##1]\leavevmode\begin{addmargin}{\nesting}%%
  }{%%
    \end{addmargin}\end{#1}
  }
}

% core environments.
% ------------------------------------------------------------------------------
\newcommand{\df}[1]{{\bfseries#1}}
\newcommand{\conclude}{\phantom{}\hfill\ensuremath{\blacktriangleleft}}

% PASSING THM NAMES SEEMS TO MESS UP VARIOREF -- HARDCODED UNTIL SOLN FOUND
% \newcommand{\@defntitle}{Defn}
% \newcommand{\@posttitle}{Postulate}
% \newcommand{\@thmtitle}{Thm}
% \newcommand{\@proptitle}{Proposition}
% \newcommand{\defntitle}[1]{\renewcommand{\@defntitle}{#1}}
% \newcommand{\posttitle}[1]{\renewcommand{\@posttitle}{#1}}
% \newcommand{\thmtitle}[1]{\renewcommand{\@thmtitle}{#1}}
% \newcommand{\proptitle}[1]{\renewcommand{\@proptitle}{#1}}

\theoremstyle{plain}
  \newtheorem{thm}{Theorem}[section]
  \newtheorem{post}[thm]{Postulate}
  \newtheorem{prop}[thm]{Proposition}
  \newtheorem*{prop*}{Proposition}
  \newtheorem{lemma}[thm]{Lemma}
\theoremstyle{definition}
  \newtheorem{defn}[thm]{Defn}
  \newtheorem*{defn*}{Defn}


% core macros.
% ------------------------------------------------------------------------------
% symbol aliases
\newcommand{\emf}{\ensuremath{\mathcal{E}}}
\newcommand{\ep}{\epsilon}
\newcommand{\pll}{\parallel}
\newcommand{\prp}{\perp}
\newcommand{\dummycdot}{\,\cdot\,}

% var symbols
\let\oldepsilon\epsilon
\let\oldvarepsilon\varepsilon
\renewcommand{\epsilon}{\oldvarepsilon}
\renewcommand{\varepsilon}{\oldepsilon}
\let\oldphi\phi
\let\oldvarphi\varphi
\renewcommand{\phi}{\oldvarphi}
\renewcommand{\varphi}{\oldphi}
\let\oldbar\bar
\let\bar\relax \let\bar\overline

% math operators
\DeclareMathOperator{\Span}{span}
\DeclareMathOperator{\dom}{dom}
\DeclareMathOperator{\ran}{ran}
\DeclareMathOperator{\Rank}{rank}
\DeclareMathOperator{\cof}{cof}
\DeclareMathOperator{\diag}{diag}
\DeclareMathOperator{\image}{im}
\newcommand{\littleo}{{\scriptstyle\mathcal{O}}}
\newcommand{\bigo}{\mathcal{O}}
\DeclareMathOperator{\proj}{pr}
\DeclareMathOperator*{\Usum}{U}
\DeclareMathOperator*{\Lsum}{L}
\DeclareMathOperator{\vol}{vol}
\DeclareMathOperator*{\osc}{\omega}
\DeclareMathOperator{\sgn}{sgn}
\DeclareMathOperator{\Alt}{Alt}
\let\grad\relax \DeclareMathOperator{\grad}{grad}
\let\curl\relax \DeclareMathOperator{\curl}{curl}
\let\div\relax \DeclareMathOperator{\div}{div}
\DeclareMathOperator{\gcf}{gcf}
\DeclareMathOperator{\lcm}{lcm}
\DeclareMathOperator{\Abs}{abs}
\newcommand{\D}{\partial}
\DeclareMathOperator{\diam}{diam}
\DeclareMathOperator{\Gal}{Gal}
\DeclareMathOperator{\Aut}{Aut}

% integral limit aliases
\newcommand{\intl}{\int\limits}
\newcommand{\iintl}{\iint\limits}
\newcommand{\iiintl}{\iiint\limits}
\newcommand{\intt}[1]{\int\limits_{\text{#1}}}
\newcommand{\iintt}[1]{\iint\limits_{\text{#1}}}
\newcommand{\iiintt}[1]{\iiint\limits_{\text{#1}}}

% groupings
\newcommand{\recipr}[2]{\frac{#2}{#1}}
\newcommand{\abqty}[1]{\langle\,#1\,\rangle}
\newcommand{\Norm}[1]{\left\lVert#1\right\rVert}
\newcommand{\floor}[1]{\left\lfloor#1\right\rfloor}
\newcommand{\ceil}[1]{\left\lceil#1\right\rceil}

% quads
\newcommand{\qqquad}{\quad\qquad}
\newcommand{\qcom}{\qq*{,}}
\newcommand{\qocand}{\qcom\qand*}
\newcommand{\qwhere}{\qq{where}}
\newcommand{\qwhen}{\qq{when}}
\newcommand{\qst}{\qq{s.t.}}

% special set symbols
\newcommand{\sset}[1]{\mathbb{#1}}
\newcommand{\N}{\sset{N}}
\newcommand{\Z}{\sset{Z}}
\newcommand{\Q}{\sset{Q}}
\newcommand{\R}{\sset{R}}
\newcommand{\C}{\sset{C}}
\newcommand{\F}{\sset{F}}
\newcommand{\powerset}{\mathcal{P}}

% vectors
\newcommand{\uvec}[1]{\vu*{#1}}
\renewcommand{\vec}[1]{\vb*{#1}}
\newcommand{\vz}{\vec{0}}

% matrices
\newcommand{\amat}[2]{
  \qty(\begin{array}{#1}
    #2
  \end{array})
}

% lists
\newcommand{\elitemize}{%
    \setlength{\parskip}{0em}
    \NewList(%
        Hang=true,Space=3pt,Space*=3pt,Hide=1000,%
        Margin1=1.5em,Style1*=\scriptsize$\blacktriangleright$\hskip.5em,%
        Margin2=3.7em,Style2*=\scriptsize$\blacktriangleright$\hskip.7em,%
        Margin3=5.9em,Style3*=$\circ$\hskip.5em,%
        Margin4=7.8em,Style4*=$\ast$\hskip.5em%
    )%
}
\newcommand{\elrmskip}{%%
    \ListProperties(%%
        Space=0pt,Space*=0pt%%
    )%%
}

% latex utils
\AL
\ifcsname f@nch@setoffs\endcsname\else
    \let\f@nch@setoffs\fancy@setoffs
\fi
\newcommand{\rehdr}{\f@nch@setoffs}
\AO

% ------------------------------------------------------------------------------

% from sets, TODO: organize, tidy
\newcommand{\TODO}[1]{\textbf{[\emph{TODO}} #1\textbf{]}}

\DeclareMathOperator{\nil}{nil}
\DeclareMathOperator{\Ann}{Ann}
\DeclareMathOperator{\Spec}{Spec}
\DeclareMathOperator{\Max}{Max}
\DeclareMathOperator{\ob}{ob}
\newcommand{\category}[1]{\textsf{\textbf{#1}}}

\usepackage{bbm}
\usepackage{stmaryrd}
\newcommand{\1}{\mathbbm{1}}
\DeclareMathOperator{\Hom}{Hom}
\DeclareMathOperator{\Nat}{Nat}

\newcommand{\nn}{\nonumber}

\DeclareMathOperator{\coker}{coker}

\let\oldleq\leq \let\leq\relax \let\leq\leqslant
\let\oldgeq\geq \let\geq\relax \let\geq\geqslant

\DeclareMathOperator{\rel}{\ rel\ }

\DeclareMathOperator{\supp}{supp}
\newcommand{\midqty}[2]{\left.#1\ \middle\vert\ #2\right.}

\let\oldtilde\tilde \let\tilde\relax \let\tilde\widetilde
